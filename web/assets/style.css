/* Path: web/assets/style.css */

/* --- 1. VARIABLES & THEME SETUP --- */
:root {
    /* Colors */
    --primary-color: #8b4513;        /* Nâu đất chủ đạo */
    --primary-hover: #a0522d;
    --bg-body: #f4f4f9;              /* Nền xám nhạt */
    --bg-card: #ffffff;              /* Nền trắng nội dung */
    --text-main: #333333;
    --text-muted: #666666;
    --text-light: #888888;
    
    /* Sutta Text Colors */
    --text-pali: #777777;
    --text-eng: #222222;
    --highlight-color: #fff9c4;
    
    /* UI Elements */
    --border-color: #ddd;
    --border-light: #eee;
    --shadow-soft: 0 2px 10px rgba(0, 0, 0, 0.05);
    --shadow-card: 0 4px 15px rgba(0, 0, 0, 0.1);
    
    /* Typography */
    --font-main: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    --font-sutta: "Noto Sans", sans-serif;
    
    /* Spacing */
    --container-width: 800px;
    --radius-md: 6px;
    --radius-sm: 4px;
}

/* --- 2. FONTS --- */
@font-face {
    font-family: 'Noto Sans';
    src: url('fonts/NotoSans-VariableFont_wdth,wght.ttf') format('truetype');
    font-weight: 100 900;
    font-stretch: 75% 125%; 
    font-style: normal;
    font-display: swap;
}

@font-face {
    font-family: 'Noto Sans';
    src: url('fonts/NotoSans-Italic-VariableFont_wdth,wght.ttf') format('truetype');
    font-weight: 100 900;
    font-stretch: 75% 125%; 
    font-style: italic;
    font-display: swap;
}

/* --- 3. RESET & BASE STYLES --- */
* {
    box_sizing: border-box;
}

body {
    font-family: var(--font-main);
    background-color: var(--bg-body);
    color: var(--text-main);
    max-width: var(--container-width);
    margin: 0 auto;
    padding: 0 20px 20px 20px;
    line-height: 1.6;
}

/* Base Button Reset */
button {
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s ease;
}

.hidden {
    display: none !important;
}

/* --- 4. HEADER & CONTROLS --- */
header {
    text-align: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

/* Main Call-to-Action Button (Random) */
#btn-random {
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    padding: 12px 28px;
    font-size: 1.1rem;
    font-weight: bold;
    border-radius: var(--radius-md);
    box-shadow: 0 4px 6px rgba(139, 69, 19, 0.2);
}

#btn-random:hover:not(:disabled) {
    background-color: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 6px 8px rgba(139, 69, 19, 0.25);
}

#btn-random:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}

#status {
    margin-top: 10px;
    color: var(--text-muted);
    font-size: 0.9em;
    font-style: italic;
}

/* --- 5. FILTERS & DRAWER --- */
#filter-container {
    margin-bottom: 15px;
}

/* Icon Toggle Button */
.icon-trigger {
    background: transparent;
    border: none;
    color: var(--text-light);
    padding: 5px 15px;
    opacity: 0.6;
    display: inline-flex;
    justify-content: center;
}

.icon-trigger:hover, .icon-trigger.open {
    color: var(--primary-color);
    opacity: 1;
    transform: scale(1.1);
}

.icon-trigger.open {
    transform: rotate(180deg);
}

.icon-trigger svg {
    width: 20px;
    height: 20px;
}

/* Drawer Area */
#filter-drawer {
    margin-top: 10px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: var(--radius-md);
    border: 1px dashed var(--border-color);
    animation: slideDown 0.3s ease-out;
}

.filter-label {
    font-size: 0.85em;
    color: var(--primary-color);
    margin-bottom: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.filter-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    margin-bottom: 10px;
}

/* Filter Buttons */
.filter-btn {
    background-color: #e8e0d9;
    color: #5d4037;
    border: 1px solid transparent;
    padding: 6px 14px;
    font-size: 0.9rem;
    border-radius: var(--radius-sm);
}

.filter-btn:hover {
    background-color: #d7ccc0;
}

.filter-btn.active {
    background-color: var(--primary-color);
    color: #fff;
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.text-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 0.85rem;
    text-decoration: underline;
    opacity: 0.8;
}

.text-btn:hover {
    opacity: 1;
}

/* --- 6. NAVIGATION HEADER (Top Nav) --- */
#nav-header {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    gap: 15px;
    animation: fadeIn 0.5s;
}

.nav-arrow {
    background: none;
    border: none;
    font-size: 1.8rem;
    color: var(--primary-color);
    padding: 0 10px;
    line-height: 1;
    opacity: 0.6;
}

.nav-arrow:hover:not(:disabled) {
    transform: scale(1.2);
    opacity: 1;
}

.nav-arrow:disabled {
    color: var(--text-light);
    cursor: default;
    opacity: 0.2;
}

#nav-title-display {
    text-align: center;
    /* Kích thước tối thiểu/tối đa để ổn định layout */
    min-width: 220px; 
    max-width: 450px; 
    min-height: 3.5rem;
    padding: 4px 12px;
    border-radius: var(--radius-md);
    cursor: pointer;
    
    /* Layout: Flexbox để căn giữa toàn bộ khối */
    display: flex;
    justify-content: center;
    align-items: center;
    
    position: relative; /* Quan trọng để neo ô Input */
    transition: background-color 0.2s;
}

#nav-title-display:hover {
    background-color: rgba(0,0,0,0.03);
}

/* --- TEXT MODE (Hiển thị tiêu đề) --- */
#nav-title-text {
    width: 100%;
    /* [FIX] Sử dụng Flex Column để bắt buộc xuống dòng */
    display: flex;
    flex-direction: column; 
    align-items: center; /* Căn giữa theo trục dọc */
    justify-content: center;
    line-height: 1.3; /* Giãn dòng vừa phải */
}

/* Logic ẩn hiện đặc biệt: */
/* Khi Text bị ẩn (do đang nhập liệu), ta dùng visibility:hidden 
   thay vì display:none để nó VẪN CHIẾM CHỖ, giúp mũi tên không bị giật vào trong. */
#nav-title-display #nav-title-text.hidden {
    display: flex !important; /* Vẫn giữ flex để giữ kích thước */
    visibility: hidden;       /* Chỉ tàng hình thôi */
    opacity: 0;
}

#nav-main-title {
    display: block;
    font-weight: 700;
    font-size: 1.15rem; /* Tăng nhẹ cỡ chữ chính */
    color: var(--text-main);
    white-space: nowrap; /* Tránh ngắt dòng giữa chừng nếu tên ngắn */
}

#nav-sub-title {
    display: block;
    font-size: 0.9rem;
    color: var(--text-muted);
    font-style: italic;
    /* Cho phép tên dài được xuống dòng nếu cần, hoặc cắt bớt */
    max-width: 100%; 
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap; 
    padding: 0 5px; 
}

/* --- INPUT MODE (Ô nhập liệu) --- */
#nav-search-container {
    display: flex;
    align-items: center;
    gap: 5px;
    
    /* [FIX] Position Absolute để nổi lên trên Text */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    
    width: 90%; 
    z-index: 10;
}

/* Khi container Search bị ẩn, ta dùng display:none thật để không chắn click vào Text */
#nav-title-display #nav-search-container.hidden {
    display: none !important;
}

#nav-sutta-input {
    width: 100%;
    /* [FIX] Giảm padding dọc để input gọn hơn */
    padding: 0 10px; 
    border: 1px solid var(--primary-color);
    border-radius: var(--radius-sm);
    text-align: center;
    font-weight: bold;
    color: var(--primary-color);
    outline: none;
    font-size: 16px; 
    
    /* [FIX] Giảm chiều cao xuống 2rem cho gọn gàng */
    height: 2rem; 
    
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    background: white;
}

#nav-search-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    padding: 0 12px;
    
    /* [FIX] Chiều cao nút phải khớp với input */
    height: 2rem; 
    
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    
    /* Căn chỉnh text/icon bên trong nút */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* --- 7. MAIN SUTTA CONTAINER --- */
#sutta-container {
    background: var(--bg-card);
    padding: 40px;
    border-radius: 8px;
    box-shadow: var(--shadow-soft);
    min-height: 300px;
}

.placeholder {
    text-align: center;
    color: var(--text-light);
    margin-top: 40px;
}

/* --- Reset List & Ẩn Metadata thừa --- */
#sutta-container ul {
    list-style-type: none;
    padding-left: 0;
    margin: 0;
}

/* Ẩn thông tin Nikaya/Chapter ở đầu bài kinh */
#sutta-container header ul {
    display: none;
}

/* Typography Content */
h1.sutta-title {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 30px;
    line-height: 1.3;
}

h1.sutta-title .pli {
    display: block;
    font-size: 0.85em;
    color: var(--text-pali);
    font-weight: normal;
}

.evam {
    font-variant: small-caps;
    font-weight: bold;
    color: var(--text-main);
}

p {
    margin-bottom: 1.2em;
}

/* Segment Styling */
.segment {
    display: block;
    margin-bottom: 0;
}

.pli {
    font-family: var(--font-sutta);
    color: var(--text-pali);
    font-style: italic;
    font-size: 0.95em;
    display: block;
    margin-bottom: 4px;
}

.eng {
    color: var(--text-eng);
    font-weight: 400;
}

/* Highlighting */
.segment:target,
.segment.highlight {
    background-color: var(--highlight-color);
    padding: 2px 5px;
    border-radius: 4px;
    transition: background-color 0.5s;
}

/* --- 8. FOOTER NAVIGATION (Prev/Next in content) --- */
.sutta-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 50px;
    padding-top: 20px;
    border-top: 1px solid var(--border-light);
}

.sutta-nav button.nav-btn {
    background: none;
    border: 1px solid transparent;
    color: var(--primary-color);
    padding: 8px 12px;
    font-size: 0.95rem;
    text-align: left;
    border-radius: var(--radius-sm);
    max-width: 48%;
}

.sutta-nav button.nav-btn:hover {
    background-color: #f9f9f9;
    border-color: var(--border-light);
}

.sutta-nav button.nav-btn:last-child {
    text-align: right;
}

.nav-title {
    display: block;
    font-size: 0.8rem;
    color: var(--text-light);
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* --- 9. COMMENT POPUP --- */
.comment-marker {
    color: #d35400;
    font-weight: bold;
    cursor: pointer;
    font-size: 0.75em;
    vertical-align: super;
    margin-left: 2px;
    padding: 0 3px;
    user-select: none;
}

.comment-marker:hover {
    background-color: #ffe0b2;
    border-radius: 50%;
}

#comment-popup {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 600px;
    
    max-height: 50vh;
    overflow-y: auto;
    overscroll-behavior: contain;
    
    background-color: var(--bg-card);
    border-left: 5px solid #d35400;
    
    /* [FIX] Shadow phức hợp: 
       - Lớp 1 (0 10px...): Bóng đổ xuống dưới sâu hơn để tạo độ nổi.
       - Lớp 2 (0 -5px...): Bóng đổ lên trên để làm rõ mép trên (upper edge).
    */
    box-shadow: 0 10px 30px rgba(0,0,0,0.15), 0 -5px 15px rgba(0,0,0,0.05);
    
    padding: 20px 40px 20px 25px;
    border-radius: 4px;
    z-index: 1000;
    
    /* [FIX] Tăng font-size lên 1rem (bằng văn bản thường) hoặc 1.05rem */
    font-size: 1rem; 
    line-height: 1.6; /* Giãn dòng cho dễ đọc */
    
    color: var(--text-main);
    transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    opacity: 1;
}

/* [OPTIONAL] Tùy chỉnh thanh cuộn cho đẹp hơn trên Chrome/Safari/Edge */
#comment-popup::-webkit-scrollbar {
    width: 6px;
}

#comment-popup::-webkit-scrollbar-track {
    background: transparent; 
}

#comment-popup::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.2); 
    border-radius: 10px;
}

#comment-popup::-webkit-scrollbar-thumb:hover {
    background-color: rgba(0, 0, 0, 0.3); 
}

#comment-popup.hidden {
    opacity: 0;
    transform: translate(-50%, 30px);
    pointer-events: none;
}

#close-comment {
    position: absolute;
    top: 5px;
    right: 5px;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--text-light);
    line-height: 1;
}

#close-comment:hover {
    color: var(--text-main);
}

/* --- 10. ANIMATIONS --- */
@keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* --- 11. MEDIA QUERIES --- */
@media (max-width: 600px) {
    body {
        padding: 0 10px 20px 10px;
    }
    
    #sutta-container {
        padding: 20px 15px;
    }
    
    h1.sutta-title {
        font-size: 1.4rem;
    }
    
    .nav-arrow {
        font-size: 1.5rem;
        padding: 0 5px;
    }
    
    #nav-title-display {
        min-width: 140px;
    }
}