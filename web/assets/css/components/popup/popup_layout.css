/* Path: web/assets/css/components/popup/popup_layout.css */

/* --- SHARED STYLES --- */
:root {
  --popup-comment-height: 40vh;
  --popup-quicklook-top: 70px;
}

/* [REMOVED] TTS Popup Offset Logic - TTS is now at Top */

.popup-container {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  
  /* [UPDATED] Full width on mobile to avoid side gaps */
  width: 100%;
  max-width: var(--container-width);
  
  background-color: var(--bg-card);
  display: flex;
  flex-direction: column;
  box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.15);
  opacity: 1;
  
  /* [FIX] Stick to bottom, ignore TTS */
  bottom: 0 !important;
  border-radius: 0;
}

.popup-container.hidden {
  opacity: 0;
  transform: translate(-50%, 100%); /* Slide down fully */
  pointer-events: none;
}

.popup-body {
  position: relative;
  /* [UPDATED] Add Safe Area Padding internally */
  padding: var(--popup-padding-mobile);
  /* Base padding + Extra breathing room (30px) + Safe Area */
  padding-bottom: calc(var(--popup-padding-y-mobile) + 30vh + env(safe-area-inset-bottom, 20px));
  
  overflow-y: auto;
  overscroll-behavior: contain;
  touch-action: pan-y;
  flex: 1;
  min-height: 0;
}

/* [NEW] PWA Adjustment: Remove extra bottom padding (no address bar) */
@media all and (display-mode: standalone) {
  .popup-body {
    padding-bottom: calc(var(--popup-padding-y-mobile) + 30vh + env(safe-area-inset-bottom, 0px)); 
  }
}

@media (min-width: 600px) {
  .popup-body { 
      padding: var(--popup-padding-desktop);
      padding-bottom: var(--popup-padding-desktop);
  }
  /* On desktop/tablet, restore floating look if desired */
  .popup-container {
      width: 96%;
      bottom: 0 !important; /* [FIXED] Remove gap */
      border-radius: 0; /* [FIXED] Flat bottom */
  }
}

/* --- COMMENT POPUP (Layer 1) --- */
#comment-popup {
  bottom: 0;
  max-height: var(--popup-comment-height);
  height: var(--popup-comment-height);
  /* border-left: 5px solid var(--primary-color); */
  z-index: 1020;
  transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s;
}

/* --- QUICKLOOK POPUP (Layer 2) --- */
#quicklook-popup {
  top: var(--popup-quicklook-top);
  /* Sits above Comment Popup if open, but mostly independent now */
  bottom: 0;
  height: auto;
  max-height: 60vh; /* Limit height */
  border-radius: 0;
  /* border-left: 5px solid var(--primitive-brown-300); */
  border-bottom: none;
  z-index: 1010;
  transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.2s;
}

/* [NEW] Stacking Logic: When Comment Popup is open, lift Quicklook above it */
body.popup-open #quicklook-popup {
  bottom: var(--popup-comment-height) !important;
  top: auto; /* Let it grow upwards from the bottom constraint */
  max-height: calc(100vh - var(--popup-comment-height) - var(--popup-quicklook-top));
}

#quicklook-popup.hidden {
  opacity: 0;
  pointer-events: none;
  transform: translate(-50%, 100%);
}

/* Ensure content isn't hidden behind floating nav */
#comment-popup .popup-body {
  /* padding-bottom handled by generic rule */
}

/* [NEW] Quicklook Specific: Add extra breathing room at bottom for comfortable scrolling */
#quicklook-popup .popup-body {
  padding-bottom: 80px !important;
}

/* [NEW] Body Padding for Popup */
body.popup-open, body.lookup-open {
  /* No special body padding needed for bottom popups if they overlay content */
  /* But if we want to scroll content fully: */
  padding-bottom: 45vh !important;
  transition: padding-bottom 0.3s ease;
}
